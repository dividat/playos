#!/usr/bin/env bash

tmpdir=`mktemp -d`
function cleanup() {
  rm -rf "$tmpdir"
}
trap "cleanup" EXIT

qemu-img create -f qcow2 -o backing_file=$disk $tmpdir/disk.qcow2
cp $OVMF $tmpdir/OVMF.fd
chmod +w $tmpdir/OVMF.fd

qemu-system-x86_64 $@ -m 2048 -pflash $tmpdir/OVMF.fd $tmpdir/disk.qcow2

